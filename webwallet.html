<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Hello Bulma!</title>
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.0/css/bulma.min.css">
		<script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
		<script>
		window.onload = function(){
			let message;
			let version_received;
			let sendinfo;
			let ws = new WebSocket("ws://revoxhere.ct8.pl:14808");
			let login = document.querySelector('.login');
			let loginInput = document.querySelector('.loginInput');
			let send = document.querySelector('.send');

			var divOne = document.getElementById('recipientInput');
			divOne.style.display='none';
			var divOne = document.getElementById('amountInput');
			divOne.style.display='none';
			var divOne = document.getElementById('sendInput');
			divOne.style.display='none';
			var divOne = document.getElementById('balancetext');
			divOne.style.display='none';

			ws.onmessage = function (event) {
				let server_message = event.data;
				console.log("Server: " + server_message)

				if (server_message.includes("1.")) {
					document.getElementById("loginstatus").innerHTML = "Proxy server is online";
					version_received = 1;
				}
				else if (server_message == "OK") {
					document.getElementById("loginstatus").innerHTML = "Logged-in successfully!";
					$("#usernameInput").fadeOut(500);
					$("#pwdInput").fadeOut(500);
					$("#loginInput").fadeOut(500);

					setTimeout(function (){
						$("#recipientInput").fadeIn(500);
						$("#amountInput").fadeIn(500);
						$("#sendInput").fadeIn(500);
						$("#balancetext").fadeIn(500);
					}, 500);
				}

				else if (server_message.includes("NO")) {
					document.getElementById("loginstatus").innerHTML = "Error loging-in";
				}

				else if (version_received == 1 && server_message.includes(".")) {
					document.getElementById("balancetext").innerHTML = "<i class='fa fa-coins fa-fw'></i>" + "Balance: " + server_message + " á•²";
				}
				else if (sendinfo == 1) {
					document.getElementById("loginstatus").innerHTML = "Server message: " + server_message;
					sendinfo = 0;
				}
			}

			login.onclick = function (event) {
				var username = document.getElementById("username").value;
				var password = document.getElementById("password").value;
				ws.send("LOGI,"+username+","+password);
				setTimeout(() => ws.send("FROM,Webwallet,-,-\n"), 150)
				window.setInterval(function(){
					ws.send("BALA")}, 750);
			}

			send.onclick = function (event) {
				var recipient = document.getElementById("recipient").value;
				var amount = document.getElementById("amount").value;
				ws.send("SEND,-,"+recipient+","+amount);
				sendinfo = 1;
			}
		}
		</script>
	</head>
	<body>
	<section class="section">
		<div class="container">
			<h1 class="title">
				 Duino-Coin Web Wallet
			</h1>
			<p class="subtitle">
				Web version of <strong>Duino-Coin Wallet</strong>!
			</p>

			<h4 class="subtitle is-6" id="loginstatus">
				Connecting... (If you're seeing this message for more than few seconds that means the proxy server is offline
			</h4>

			<br>

			<h2 class="title is-2"id="balancetext"></h2>

			<table>
			<th>
			<div id="usernameInput" class="field">
				<p class="control has-icons-left">
					<input class="input" id="username" type="text" placeholder="Username">
					<span class="icon is-small is-left">
						<i class="fas fa-user"></i>
					</span>
				</p>
			</div>
			</th>

			<th>
			<div id="pwdInput" class="field">
				<p class="control has-icons-left">
					<input class="input" id="password" type="password" placeholder="Password">
					<span class="icon is-small is-left">
						<i class="fas fa-lock"></i>
					</span>
				</p>
			</div>
			</th>

			<th>
			<div id="loginInput" class="buttons">
				<button class="button is-primary login">Login</button>
			</div>
			</th>
			</table>

			<table>
			<th>
			<div id="recipientInput" class="field">
				<p class="control has-icons-left has-icons-right">
					<input class="input" id="recipient" type="text" placeholder="Recipient">
					<span class="icon is-small is-left">
						<i class="fas fa-address-book"></i>
					</span>
				</p>
			</div>
			</th>

			<th>
			<div id="amountInput" class="field">
				<p class="control has-icons-left has-icons-right">
					<input class="input" id="amount" type="number" placeholder="Amount">
					<span class="icon is-small is-left">
						<i class="fas fa-credit-card"></i>
					</span>
				</p>
			</div>
			</th>

			<th>
			<div id="sendInput" class="buttons">
				<button class="button is-warning send">Send</button>
			</div>
			</th>

	</section>
	</body>
</html>
